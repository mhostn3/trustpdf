<!-- Cookie Consent Banner -->
<div id="cookie-banner" style="
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: white;
  border: 1px solid #ccc;
  border-radius: 10px;
  padding: 16px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
  max-width: 300px;
  font-family: sans-serif;
  z-index: 9999;
  display: none;
">
  <p style="margin: 0 0 10px 0; font-size: 14px;">
    We use cookies to improve your experience. See our
    <a href="{% url 'cookies' %}" target="_blank" style="color: #007BFF;">cookie policy</a>.
  </p>
  <div style="text-align: right;">
    <button onclick="rejectCookies()" style="
      background: #eee;
      border: none;
      padding: 6px 12px;
      margin-right: 6px;
      border-radius: 5px;
      cursor: pointer;
    ">Reject</button>
    <button onclick="acceptCookies()" style="
      background: #007BFF;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
    ">Accept</button>
  </div>
</div>

<script>
  function setCookie(name, value, days) {
    const d = new Date();
    d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
    document.cookie = name + "=" + value + ";expires=" + d.toUTCString() + ";path=/";
  }

  function getCookie(name) {
    const match = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
    return match ? match.pop() : '';
  }

  function loadGA4() {
    const GA_MEASUREMENT_ID = 'G-QDRB36WEKZ'; // 🔁 Replace with your GA4 ID

    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }

    const script = document.createElement('script');
    script.src = `https://www.googletagmanager.com/gtag/js?id=${GA_MEASUREMENT_ID}`;
    script.async = true;
    document.head.appendChild(script);

    script.onload = () => {
      gtag('js', new Date());
      gtag('config', GA_MEASUREMENT_ID);
    };
  }

  function acceptCookies() {
    setCookie('cookie_consent', 'accepted', 365);
    document.getElementById('cookie-banner').style.display = 'none';
    loadGA4();
  }

  function rejectCookies() {
    setCookie('cookie_consent', 'rejected', 365);
    document.getElementById('cookie-banner').style.display = 'none';
  }

  window.onload = function () {
    const consent = getCookie('cookie_consent');
    if (!consent) {
      document.getElementById('cookie-banner').style.display = 'block';
    } else if (consent === 'accepted') {
      loadGA4();
    }
  };
</script>
